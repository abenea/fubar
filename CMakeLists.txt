cmake_minimum_required(VERSION 2.6)
project(fubar)
enable_testing()
set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake)

find_package(Boost REQUIRED)
find_package(Taglib REQUIRED)
find_package(ProtocolBuffers REQUIRED)
find_package(Qt4 4.5 REQUIRED QtCore QtGui QtTest Phonon)
include(${QT_USE_FILE})
find_package(XInput2 REQUIRED)
find_package(Qxt REQUIRED QxtCore QxtGui)
find_package(KDE4 REQUIRED)

include_directories(${Qxt_INCLUDE_DIRS})

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -std=c++0x -fexceptions")

include_directories(${CMAKE_CURRENT_BINARY_DIR})
include_directories(${CMAKE_CURRENT_SOURCE_DIR})
function(add_qtest name src libs)
    qt4_automoc(${${src}})
    add_executable(${name} ${${src}})
    target_link_libraries(${name} ${${libs}})
    add_test(${name} ${name})
endfunction()

add_subdirectory(ui)
add_subdirectory(library)

qt4_add_resources(ui_RC ui/icons/icons.qrc)
add_executable(fubar main.cpp ${ui_RC})
add_executable(testlib testlib.cpp ${ui_RC})
target_link_libraries(testlib ui library ${QT_LIBRARIES})
target_link_libraries(fubar library ui ${QT_LIBRARIES} ${Qxt_LIBRARIES} ${KDE4_KDEUI_LIBS})
