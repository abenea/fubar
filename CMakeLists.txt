cmake_minimum_required(VERSION 2.6)
project(fubar)
enable_testing()
set(CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake)

find_package(Boost REQUIRED)
find_package(Taglib 1.8.0 REQUIRED)
find_package(ProtocolBuffers REQUIRED)
find_package(Qt4 4.5 REQUIRED QtCore QtGui QtTest Phonon)
include(${QT_USE_FILE})
find_package(KDE4 REQUIRED)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -std=c++0x -fexceptions")

include_directories(${CMAKE_CURRENT_BINARY_DIR})
include_directories(${CMAKE_CURRENT_SOURCE_DIR})
function(add_qtest name src libs)
    qt4_automoc(${${src}})
    add_executable(${name} ${${src}})
    target_link_libraries(${name} ${${libs}})
    add_test(${name} ${name})
endfunction()

add_subdirectory(ui)
add_subdirectory(library)
add_subdirectory(plugins)

qt4_add_resources(ui_RC ui/icons/icons.qrc)
qt4_automoc(unixsignalshandler.cpp)
add_executable(fubar plugins/pluginmanager.cpp main.cpp util.cpp unixsignalshandler.cpp ${ui_RC})
add_executable(testlib testlib.cpp util.cpp)
target_link_libraries(testlib ui library ${QT_LIBRARIES} ${TAGLIB_LIBRARY})
target_link_libraries(fubar library ui ${QT_LIBRARIES} ${TAGLIB_LIBRARY} ${KDE4_KDEUI_LIBS})